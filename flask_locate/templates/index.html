{% extends "base.html" %}

{% block body_attribs %} ng-app="myApp"{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.min.js"></script>
<script src="{{ url_for('static', filename='lib/angular-csv-import/dist/angular-csv-import.js')}}"></script>
<script>
var data = [];
angular.module('myApp',['ngCsvImport'])
    .controller('CSVController', ['$scope', '$parse', function ($scope, $parse) {
        window.MY_SCOPE = $scope;
        $scope.csv = {
            content: null,
            header: false,
            seperator: "','",
            result: null
        };

        var _lastGoodResult = '';
        $scope.toPrettyJSON = function (objStr, tabWidth) {
            var obj = null;
            try {
                obj = $parse(objStr)({});
            } catch(e) {
                // eat $parse error
                return _lastGoodResult;
            }

            var result = JSON.stringify(obj, null, Number(tabWidth));
            _lastGoodResult = result;

            return result
        }
        var _lastrejson = []
        $scope.reJSON = function (objStr) {
            //console.log("String:", objStr);
            //var out = null;
            try {
                _lastrejson = $parse(objStr)({});
            } catch(e) {
                return _lastrejson;
            }
            //console.log(out);
            return _lastrejson;
        }
    }]);
</script>
{% endblock %}

{% block content %}
    <div class="jumbotron">
        <div class="container">
            <h1>Make a Map</h1>
        </div>
    </div>

    <div class="container" ng-controller="CSVController">
        <div class="row">
            <div class="col-xs-12">
                <div>
                    <h2>Step 1: Name and information</h2>
                    First lets upload a file:
                    <ng-csv-import
		              class="import"
		              content="csv.content"
		              header="false"
		              separator="','"
		              result="csv.result"></ng-csv-import>
                <div ng-if="csv.content">
                    <h2>CSV</h2>
                    {% raw %}
                    <div><pre>{{ csv.content }}</pre></div>
                    {% endraw %}
                </div>
                <div ng-if="csv.result">
                    <h2>JSON</h2>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                {% raw %}
                                    <th ng-repeat="(key, value) in reJSON(csv.result)[0]">Header</th>
                                {% endraw %}
                            </tr>
                        <tbody>
                            {% raw %}
                            <tr ng-repeat="row in reJSON(csv.result) track by $index">
                                <td ng-repeat="(key, value) in row">{{ value }}</td>
                            </tr>
                            {% endraw %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
{% endblock %}
